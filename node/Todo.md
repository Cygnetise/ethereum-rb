ideally, port this stuff to ruby - at least with opal
